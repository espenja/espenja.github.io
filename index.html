<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Addon Recommendations</title>
    <link rel="icon" type="image/svg+xml" href="img/wowicon.svg" />
    <style>
      :root {
        --bg-primary: #0d1117;
        --bg-secondary: #161b22;
        --bg-tertiary: #21262d;
        --bg-hover: #30363d;
        --text-primary: #c9d1d9;
        --text-secondary: #8b949e;
        --text-bright: #f0f6fc;
        --accent-primary: #58a6ff;
        --accent-secondary: #4ba0f6;
        --border-color: #21262d;
        --code-bg: #161b22;
        --note-bg: #161b22;
      }

      [data-theme="light"] {
        --bg-primary: #ebe9e6;
        --bg-secondary: #f2f0ed;
        --bg-tertiary: #d9d7d4;
        --bg-hover: #e3e1de;
        --text-primary: #2d2d2d;
        --text-secondary: #5c5c5c;
        --text-bright: #1a1a1a;
        --accent-primary: #0969da;
        --accent-secondary: #0550ae;
        --border-color: #c8c6c3;
        --code-bg: #e8e6e3;
        --note-bg: #e8e6e3;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        background-color: var(--bg-primary);
        color: var(--text-primary);
        font-family:
          -apple-system, BlinkMacSystemFont, "Segoe UI", "Noto Sans", Helvetica,
          Arial, sans-serif;
        font-size: 16px;
        line-height: 1.6;
        padding: 20px;
        transition:
          background-color 0.3s ease,
          color 0.3s ease;
      }

      .container {
        max-width: 1024px;
        margin: 0 auto;
        padding: 40px 20px;
      }

      h1 {
        color: var(--text-bright);
        font-size: 2em;
        font-weight: 600;
        margin-bottom: 0.5em;
        padding-bottom: 0.3em;
        border-bottom: 1px solid var(--border-color);
      }

      h2 {
        color: color-mix(in oklab, var(--accent-secondary), white 40%);
        font-size: 1.5em;
        font-weight: 600;
        margin-top: 1.5em;
        margin-bottom: 0.5em;
        cursor: pointer;
        user-select: none;
        display: flex;
        align-items: center;
        gap: 8px;
      }

      h2::before {
        content: "â–¼";
        font-size: 0.7em;
        transition: transform 0.2s ease;
        display: inline-block;
      }

      h2.collapsed::before {
        transform: rotate(-90deg);
      }

      h3 {
        color: var(--text-bright);
        font-size: 1.25em;
        font-weight: 600;
        margin-top: 1.2em;
        margin-bottom: 0.5em;
      }

      .addon-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 0.5em;
        flex-wrap: wrap;
        gap: 10px;
      }

      .addon-header-left {
        display: flex;
        flex-direction: column;
        gap: 8px;
        flex: 1;
        min-width: 0;
      }

      .addon-title-row {
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .addon-badge-row {
        display: flex;
        flex-wrap: wrap;
        gap: 6px;
        align-items: center;
      }

      .addon-header h3 {
        margin: 0;
      }

      .addon-badge {
        display: inline-block;
        background-color: #1f6feb;
        color: #ffffff;
        padding: 3px 8px;
        border-radius: 3px;
        font-size: 0.7em;
        font-weight: 600;
        white-space: nowrap;
      }

      .addon-badge.green {
        background-color: #238636;
      }

      .addon-badge.yellow {
        background-color: #dd9300;
      }

      .addon-badge.red {
        background-color: #cf222e;
      }

      .addon-badge.purple {
        background-color: #8957e5;
      }

      .command-badge {
        background-color: var(--code-bg);
        color: var(--accent-primary);
        padding: 4px 10px;
        border-radius: 3px;
        font-family: "Consolas", "Monaco", "Courier New", monospace;
        font-size: 0.85em;
        border: 1px solid var(--border-color);
        white-space: nowrap;
      }

      .description-badge {
        background-color: #2f3c4e;
        color: #ffffff;
      }

      [data-theme="light"] .description-badge {
        background-color: #5a6c7d;
        color: #ffffff;
      }

      h4 {
        color: var(--text-secondary);
        font-size: 1em;
        font-weight: 600;
        margin-top: 1em;
        margin-bottom: 0.5em;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        font-size: 0.85em;
      }

      p {
        margin-bottom: 1em;
        color: var(--text-primary);
      }

      ul,
      ol {
        margin-bottom: 1em;
        padding-left: 2em;
      }

      li {
        margin-bottom: 0.25em;
        color: var(--text-primary);
      }

      code {
        background-color: var(--code-bg);
        color: var(--text-bright);
        padding: 0.2em 0.4em;
        border-radius: 3px;
        font-family: "Consolas", "Monaco", "Courier New", monospace;
        font-size: 0.9em;
      }

      pre {
        background-color: var(--code-bg);
        color: var(--text-primary);
        padding: 16px;
        border-radius: 6px;
        overflow-x: auto;
        margin-bottom: 1em;
        border: 1px solid var(--border-color);
      }

      pre code {
        background-color: transparent;
        padding: 0;
      }

      a {
        color: var(--accent-primary);
        text-decoration: none;
      }

      a:hover {
        text-decoration: underline;
      }

      img {
        max-width: 100%;
        height: auto;
        border-radius: 6px;
        border: 1px solid var(--border-color);
        margin: 1em 0;
        display: block;
      }

      .img-caption {
        text-align: center;
        color: var(--text-secondary);
        font-size: 0.9em;
        font-style: italic;
        margin-top: -0.5em;
        margin-bottom: 1em;
      }

      blockquote {
        border-left: 3px solid var(--accent-primary);
        padding-left: 1em;
        margin: 1em 0;
        color: var(--text-secondary);
        font-style: italic;
      }

      hr {
        border: none;
        border-top: 1px solid var(--border-color);
        margin: 1em 0;
      }

      .badge {
        display: inline-block;
        background-color: #1f6feb;
        color: #ffffff;
        padding: 2px 8px;
        border-radius: 3px;
        font-size: 0.75em;
        font-weight: 600;
        margin-left: 8px;
        vertical-align: middle;
      }

      .badge.green {
        background-color: #238636;
      }

      .badge.yellow {
        background-color: #dd9300;
      }

      .badge.red {
        background-color: #cf222e;
      }

      .section-wrapper {
        border-left: 4px solid var(--border-color);
        padding-left: 20px;
        margin-bottom: 2em;
      }

      .section-wrapper.must-haves {
        border-left-color: #cf222e;
      }

      .section-wrapper.frames {
        border-left-color: #dd9300;
      }

      .section-wrapper.cooldown-manager {
        border-left-color: #8957e5;
      }

      .section-wrapper.combat {
        border-left-color: #238636;
      }

      .section-wrapper.qols {
        border-left-color: #17a2b8;
      }

      .section-wrapper.visuals {
        border-left-color: #11cfa9;
      }

      .section-wrapper.other {
        border-left-color: #58a6ff;
      }

      .section-wrapper.fps {
        border-left-color: #ef66ef;
      }

      .section-wrapper.profiles {
        border-left-color: #bc7a08;
      }

      .section-wrapper.must-haves h2 {
        color: #cf222e;
      }

      .section-wrapper.frames h2 {
        color: #dd9300;
      }

      .section-wrapper.cooldown-manager h2 {
        color: #8957e5;
      }

      .section-wrapper.combat h2 {
        color: #238636;
      }

      .section-wrapper.qols h2 {
        color: #17a2b8;
      }

      .section-wrapper.visuals h2 {
        color: #11cfa9;
      }

      .section-wrapper.other h2 {
        color: #58a6ff;
      }

      .section-wrapper.fps h2 {
        color: #ef66ef;
      }

      .section-wrapper.profiles h2 {
        color: #bc7a08;
      }

      .section-content {
        overflow: hidden;
        transition:
          max-height 0.1s ease-out,
          opacity 0.08s ease-out;
        max-height: 20000px;
        opacity: 1;
      }

      .section-content.profiles div {
        padding-bottom: 1em;
      }

      .section-content.collapsed {
        max-height: 0;
        opacity: 0;
        margin: 0;
        transition:
          max-height 0.1s ease-in,
          opacity 0.03s ease-in;
      }

      .addon-block {
        margin-bottom: 1em;
        padding-bottom: 1em;
        border-bottom: 1px solid #21262d;
      }

      .addon-block:last-child {
        border-bottom: none;
      }

      strong {
        color: var(--text-bright);
        font-weight: 600;
      }

      [data-theme="light"] strong {
        color: #1a1a1a;
      }

      .note {
        background-color: var(--note-bg);
        border-left: 3px solid var(--accent-primary);
        padding: 12px 16px;
        margin: 1em 0;
        border-radius: 0 6px 6px 0;
      }

      .note strong {
        color: var(--accent-primary);
      }

      .note-green {
        border-left: 3px solid #ec7c04;
      }

      .note-green strong {
        color: #ec7c04;
      }

      .image-section {
        margin-top: 1em;
      }

      .image-toggle {
        color: var(--accent-primary);
        cursor: pointer;
        user-select: none;
        font-size: 1em;
        display: inline-flex;
        align-items: center;
        gap: 6px;
      }

      .image-toggle:hover {
        text-decoration: underline;
      }

      .image-toggle::before {
        content: "â–¼";
        font-size: 0.7em;
        transition: transform 0.2s ease;
        display: inline-block;
      }

      .image-toggle.collapsed::before {
        transform: rotate(-90deg);
      }

      .image-content {
        overflow: hidden;
        transition:
          max-height 0.3s ease,
          opacity 0.3s ease;
        max-height: 2000px;
        opacity: 1;
        margin-top: 0.5em;
      }

      .image-content.collapsed {
        max-height: 0;
        opacity: 0;
        margin: 0;
      }

      .addon-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 1em;
        display: table;
      }

      .addon-table thead {
        background-color: var(--bg-secondary);
      }

      .addon-table th {
        padding: 12px 16px;
        border: 1px solid var(--border-color);
        font-weight: 600;
        color: var(--text-bright);
        text-align: left;
      }

      .addon-table td {
        padding: 12px 16px;
        border: 1px solid var(--border-color);
        vertical-align: top;
      }

      .addon-table td:first-child {
        font-weight: 600;
        color: var(--text-bright);
        width: 30%;
      }

      .addon-table td:last-child {
        color: var(--text-primary);
        width: 70%;
      }

      .enhanceqol-table td:nth-child(2) {
        text-align: center;
      }

      /* Responsive Tables for Mobile */
      @media (max-width: 768px) {
        .addon-table {
          border: 0;
        }

        .addon-table thead {
          display: none;
        }

        .addon-table tr {
          display: block;
          margin-bottom: 12px;
          border: 1px solid var(--border-color);
          border-radius: 6px;
          background-color: var(--bg-secondary);
        }

        .addon-table td {
          display: block;
          border: none;
          border-bottom: 1px solid var(--border-color);
          text-align: left !important;
          padding: 10px 12px;
        }

        .addon-table td:last-child {
          border-bottom: none;
        }

        .addon-table td:before {
          content: attr(data-label);
          font-weight: 500;
          color: var(--text-secondary);
          display: block;
          margin-bottom: 6px;
          font-size: 0.75em;
          text-transform: uppercase;
          letter-spacing: 0.8px;
        }

        /* Special handling for enhanceqol-table */
        .enhanceqol-table td:nth-child(1):before {
          content: "Setting";
        }

        .enhanceqol-table td:nth-child(2):before {
          content: "Toggle";
        }

        .enhanceqol-table td:nth-child(3):before {
          content: "Category";
        }

        .enhanceqol-table td:nth-child(2) {
          text-align: left !important;
        }

        /* For the other addon table (2 column) */
        .addon-table:not(.enhanceqol-table) td:first-child:before {
          content: "Addon";
        }

        .addon-table:not(.enhanceqol-table) td:last-child:before {
          content: "Description";
        }

        .addon-table td:first-child {
          width: 100%;
        }

        .addon-table td:last-child {
          width: 100%;
        }
      }

      .pre-wrapper {
        position: relative;
      }

      .copy-button {
        position: absolute;
        top: 8px;
        right: 8px;
        background-color: var(--bg-tertiary);
        color: var(--text-primary);
        border: 1px solid var(--bg-hover);
        border-radius: 4px;
        padding: 6px 12px;
        font-size: 0.85em;
        cursor: pointer;
        transition: all 0.2s ease;
      }

      .copy-button:hover {
        background-color: var(--bg-hover);
        border-color: var(--accent-primary);
      }

      .copy-button.copied {
        background-color: #238636;
        border-color: #238636;
        color: #ffffff;
      }

      .pre-wrapper pre {
        padding-top: 40px;
      }

      /* Theme Switcher Button */
      .theme-switcher {
        position: fixed;
        top: 20px;
        right: 20px;
        width: 52px;
        height: 52px;
        border-radius: 50%;
        border: 2px solid var(--border-color);
        background: var(--bg-secondary);
        color: var(--text-bright);
        cursor: pointer;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 22px;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        z-index: 1000;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        outline: none;
      }

      .theme-switcher:hover {
        background: var(--bg-hover);
        transform: scale(1.1) rotate(15deg);
        box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2);
      }

      .theme-switcher:active {
        transform: scale(0.95);
      }

      /* Prevent FOUC - hide content until loaded */
      [data-include]:not(.loaded) {
        opacity: 0;
        min-height: 20px;
      }

      [data-include].loaded {
        opacity: 1;
        transition: opacity 0.2s ease-in;
      }

      [data-theme="light"] .theme-switcher {
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
      }

      [data-theme="light"] .theme-switcher:hover {
        box-shadow: 0 6px 16px rgba(0, 0, 0, 0.12);
      }

      .theme-icon {
        display: inline-block;
        transition: transform 0.3s ease;
      }

      .theme-switcher:hover .theme-icon {
        transform: rotate(-15deg);
      }

      .footer {
        text-align: center;
        font-size: 0.9em;
        color: var(--text-secondary);
      }

      /* Anchor link styles */
      html {
        scroll-behavior: smooth;
      }

      .link-icon {
        opacity: 0;
        transition: opacity 0.2s ease;
        margin-left: 8px;
        font-size: 0.8em;
        cursor: pointer;
        color: var(--text-secondary);
        text-decoration: none;
      }

      .link-icon:hover {
        color: var(--accent-primary);
      }

      h2:hover .link-icon,
      h3:hover .link-icon {
        opacity: 1;
      }

      .highlight-target {
        animation: highlight-fade 2s ease-out;
      }

      @keyframes highlight-fade {
        0% {
          background-color: rgba(88, 166, 255, 0.3);
        }
        100% {
          background-color: transparent;
        }
      }

      .addon-block {
        scroll-margin-top: 20px;
      }

      .section-wrapper {
        scroll-margin-top: 20px;
      }

      .video-container {
        display: flex;
        justify-content: center;
        margin: 20px 0;
      }
    </style>
  </head>
  <body>
    <button class="theme-switcher" id="themeSwitcher" aria-label="Toggle theme">
      <span class="theme-icon">ðŸŒ™</span>
    </button>
    <div class="container">
      <h1>Midnight Addons Tips and Tricks</h1>
      <div>
        <div class="note">
          These are addon recommendations for Midnight. These addons are tested
          and verified to currently work with the Midnight expansion and are
          either essential, recommended, or quality of life improvements.<br />
          Full profiles for some of them are at the bottom of the page. Backup
          your own stuff, and import at your own peril.
        </div>
      </div>
      <div class="section-wrapper fps" id="fps">
        <h2 onclick="toggleSection(this)">
          Possible FPS gains<a
            class="link-icon"
            onclick="copyLink(event, 'fps')"
            title="Copy link to section"
            >ðŸ”—</a
          >
        </h2>
        <div class="section-content collapsed">
          <div data-include="sections/fps-gains.html"></div>
        </div>
      </div>
      <hr />
      <div class="section-wrapper must-haves" id="core-addons">
        <h2 onclick="toggleSection(this)">
          Core Addons<a
            class="link-icon"
            onclick="copyLink(event, 'core-addons')"
            title="Copy link to section"
            >ðŸ”—</a
          >
        </h2>
        <div class="section-content collapsed">
          <div data-include="sections/core/index.html"></div>
        </div>
      </div>
      <hr />
      <div class="section-wrapper frames" id="unit-frames">
        <h2 onclick="toggleSection(this)">
          Unit Frames<a
            class="link-icon"
            onclick="copyLink(event, 'unit-frames')"
            title="Copy link to section"
            >ðŸ”—</a
          >
        </h2>
        <div class="section-content collapsed">
          <div data-include="sections/frames/index.html"></div>
        </div>
      </div>
      <hr />
      <div class="section-wrapper cooldown-manager" id="cooldown-manager">
        <h2 onclick="toggleSection(this)">
          Cooldown Manager<a
            class="link-icon"
            onclick="copyLink(event, 'cooldown-manager')"
            title="Copy link to section"
            >ðŸ”—</a
          >
        </h2>
        <div class="section-content collapsed">
          <div data-include="sections/cooldown-manager/index.html"></div>
        </div>
      </div>
      <hr />
      <div class="section-wrapper combat" id="combat">
        <h2 onclick="toggleSection(this)">
          Combat/Raid/M+<a
            class="link-icon"
            onclick="copyLink(event, 'combat')"
            title="Copy link to section"
            >ðŸ”—</a
          >
        </h2>
        <div class="section-content collapsed">
          <div data-include="sections/combat/index.html"></div>
        </div>
      </div>
      <hr />
      <div class="section-wrapper qols" id="qol">
        <h2 onclick="toggleSection(this)">
          Quality of Life<a
            class="link-icon"
            onclick="copyLink(event, 'qol')"
            title="Copy link to section"
            >ðŸ”—</a
          >
        </h2>
        <div class="section-content collapsed">
          <div data-include="sections/qol/index.html"></div>
        </div>
      </div>
      <hr />
      <div class="section-wrapper visuals" id="visuals">
        <h2 onclick="toggleSection(this)">
          Visuals<a
            class="link-icon"
            onclick="copyLink(event, 'visuals')"
            title="Copy link to section"
            >ðŸ”—</a
          >
        </h2>
        <div class="section-content collapsed">
          <div data-include="sections/visuals/index.html"></div>
        </div>
      </div>
      <hr />
      <div class="section-wrapper other" id="other">
        <h2 onclick="toggleSection(this)">
          Other good addons<a
            class="link-icon"
            onclick="copyLink(event, 'other')"
            title="Copy link to section"
            >ðŸ”—</a
          >
        </h2>
        <div class="section-content collapsed">
          <div data-include="sections/other.html"></div>
        </div>
      </div>
      <hr />
      <div class="section-wrapper profiles" id="profiles">
        <h2 class="section-header" onclick="toggleSection(this)">
          Addon Profiles<a
            class="link-icon"
            onclick="copyLink(event, 'profiles')"
            title="Copy link to section"
            >ðŸ”—</a
          >
        </h2>
        <div class="section-content collapsed">
          <div data-include="sections/profiles.html"></div>
        </div>
      </div>
    </div>
    <hr />
    <p class="footer">Last updated: 2026-02-09 00:57:37</p>
    <script>
      function addCopyButtons(container = document) {
        const preTags = container.querySelectorAll("pre:not(.has-copy-button)");

        preTags.forEach((pre) => {
          pre.classList.add("has-copy-button");

          const wrapper = document.createElement("div");
          wrapper.className = "pre-wrapper";
          pre.parentNode.insertBefore(wrapper, pre);
          wrapper.appendChild(pre);

          const copyButton = document.createElement("button");
          copyButton.className = "copy-button";
          copyButton.textContent = "Copy";
          copyButton.setAttribute("aria-label", "Copy code to clipboard");

          copyButton.addEventListener("click", () => {
            navigator.clipboard
              .writeText(pre.textContent)
              .then(() => {
                copyButton.textContent = "Copied!";
                copyButton.classList.add("copied");
                setTimeout(() => {
                  copyButton.textContent = "Copy";
                  copyButton.classList.remove("copied");
                }, 2000);
              })
              .catch((err) => {
                console.error("Failed to copy:", err);
                copyButton.textContent = "Failed";
                setTimeout(() => (copyButton.textContent = "Copy"), 2000);
              });
          });

          wrapper.insertBefore(copyButton, pre);
        });
      }

      async function loadProfiles() {
        try {
          const response = await fetch("sections/profiles/profiles.json");
          const profiles = await response.json();
          const container = document.getElementById("profiles-container");

          if (!container) {
            console.error("Profiles container not found");
            return;
          }

          for (const profile of profiles) {
            const profileDiv = document.createElement("div");
            const header = document.createElement("h4");
            header.textContent = profile.name;
            const pre = document.createElement("pre");

            try {
              const contentResponse = await fetch(profile.source);
              pre.textContent = await contentResponse.text();
            } catch (error) {
              console.error(`Failed to load profile ${profile.name}:`, error);
              pre.textContent = "Error loading profile";
            }

            profileDiv.appendChild(header);
            profileDiv.appendChild(pre);
            container.appendChild(profileDiv);
          }

          addCopyButtons(container);
        } catch (error) {
          console.error("Failed to load profiles:", error);
        }
      }

      async function loadSections(container = document) {
        const loadedFiles = new Map();

        // Step 1: Find all files we need (including nested ones)
        async function findAllFiles(root) {
          const elements = root.querySelectorAll("[data-include]:not(.loaded)");
          const filesToLoad = [];

          for (const el of elements) {
            const file = el.getAttribute("data-include");
            if (!loadedFiles.has(file)) {
              filesToLoad.push(file);
            }
          }

          if (filesToLoad.length === 0) return;

          // Fetch all files at this level
          await Promise.all(
            filesToLoad.map(async (file) => {
              try {
                const response = await fetch(file);
                if (response.ok) {
                  const html = await response.text();
                  loadedFiles.set(file, html);

                  // Check if this file has nested includes
                  const temp = document.createElement("div");
                  temp.innerHTML = html;
                  await findAllFiles(temp);
                } else {
                  console.error(`Failed to load ${file}: ${response.status}`);
                  loadedFiles.set(file, null);
                }
              } catch (error) {
                console.error(`Error loading ${file}:`, error);
                loadedFiles.set(file, null);
              }
            }),
          );
        }

        // Step 2: Inject all the HTML we loaded
        function insertContent(root) {
          const elements = root.querySelectorAll("[data-include]:not(.loaded)");

          for (const el of elements) {
            const file = el.getAttribute("data-include");
            const html = loadedFiles.get(file);

            if (html) {
              el.innerHTML = html;
              el.classList.add("loaded");
              insertContent(el);
            } else if (html === null) {
              el.innerHTML = `<p style="color: var(--text-secondary);">Failed to load ${file}</p>`;
              el.classList.add("loaded");
            }
          }
        }

        await findAllFiles(container);
        insertContent(container);

        // Add IDs and link icons to addon blocks
        addAddonAnchors();

        if (loadedFiles.has("sections/profiles.html")) {
          await loadProfiles();
        }
      }

      function addAddonAnchors() {
        const addonBlocks = document.querySelectorAll(".addon-block");

        addonBlocks.forEach((block) => {
          const h3 = block.querySelector("h3");
          if (!h3) return;

          const link = h3.querySelector("a");
          if (!link) return;

          // Generate ID from addon name
          const addonName = link.textContent.trim();
          const id = addonName
            .toLowerCase()
            .replace(/[^a-z0-9]+/g, "-")
            .replace(/^-|-$/g, "");

          // Add ID to the addon block
          block.id = id;

          // Add link icon if it doesn't exist
          if (!h3.querySelector(".link-icon")) {
            const linkIcon = document.createElement("a");
            linkIcon.className = "link-icon";
            linkIcon.textContent = "ðŸ”—";
            linkIcon.title = "Copy link to addon";
            linkIcon.onclick = (e) => copyLink(e, id);
            h3.appendChild(linkIcon);
          }
        });
      }

      function toggleSection(header) {
        const content = header.nextElementSibling;
        header.classList.toggle("collapsed");
        content.classList.toggle("collapsed");
      }

      function toggleImage(toggle) {
        const content = toggle.nextElementSibling;
        toggle.classList.toggle("collapsed");
        content.classList.toggle("collapsed");
      }

      function copyLink(event, id) {
        event.stopPropagation();
        const url = `${window.location.origin}${window.location.pathname}#${id}`;
        navigator.clipboard
          .writeText(url)
          .then(() => {
            const link = event.target;
            const originalText = link.textContent;
            link.textContent = "âœ“";
            link.style.color = "var(--accent-primary)";
            setTimeout(() => {
              link.textContent = originalText;
              link.style.color = "";
            }, 1500);
          })
          .catch((err) => {
            console.error("Failed to copy link:", err);
          });
      }

      function handleHashNavigation() {
        const hash = window.location.hash.substring(1);
        if (!hash) return;

        // Small delay to ensure all content is loaded
        setTimeout(() => {
          const targetElement = document.getElementById(hash);
          if (!targetElement) return;

          // Open parent sections if needed
          let parent = targetElement.closest(".section-content");
          while (parent) {
            if (parent.classList.contains("collapsed")) {
              const header = parent.previousElementSibling;
              if (header && header.tagName === "H2") {
                header.classList.remove("collapsed");
                parent.classList.remove("collapsed");
              }
            }
            parent = parent.parentElement?.closest(".section-content");
          }

          // Also expand if the target itself is a section
          if (targetElement.classList.contains("section-wrapper")) {
            const header = targetElement.querySelector("h2");
            const content = targetElement.querySelector(".section-content");
            if (header && content) {
              header.classList.remove("collapsed");
              content.classList.remove("collapsed");
            }
          }

          // Scroll and highlight
          setTimeout(() => {
            targetElement.scrollIntoView({
              behavior: "smooth",
              block: "start",
            });
            targetElement.classList.add("highlight-target");
            setTimeout(() => {
              targetElement.classList.remove("highlight-target");
            }, 2000);
          }, 100);
        }, 50);
      }

      // Theme switcher
      (function () {
        const themeSwitcher = document.getElementById("themeSwitcher");
        const themeIcon = themeSwitcher.querySelector(".theme-icon");
        const html = document.documentElement;
        const savedTheme = localStorage.getItem("theme") || "dark";

        function setTheme(theme) {
          if (theme === "light") {
            html.setAttribute("data-theme", "light");
            themeIcon.textContent = "ðŸŒž";
          } else {
            html.removeAttribute("data-theme");
            themeIcon.textContent = "ðŸŒ™";
          }
          localStorage.setItem("theme", theme);
        }

        setTheme(savedTheme);

        themeSwitcher.addEventListener("click", () => {
          const currentTheme = html.hasAttribute("data-theme")
            ? "light"
            : "dark";
          setTheme(currentTheme === "dark" ? "light" : "dark");
        });
      })();

      // Initialize
      document.addEventListener("DOMContentLoaded", async () => {
        await loadSections();
        addCopyButtons();
        // Wait a bit for DOM to settle, then handle hash navigation
        setTimeout(() => {
          handleHashNavigation();
        }, 100);
      });

      // Handle hash changes
      window.addEventListener("hashchange", handleHashNavigation);
    </script>
  </body>
</html>
